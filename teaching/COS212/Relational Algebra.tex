\documentclass[11pt]{beamer}

\usepackage{unicode-math}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage[style=ddmmyyyy]{datetime2}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{fontspec}
\usepackage{relsize}

\makeatletter
\def\input@path{{../../theme/}}
\makeatother

\usetheme[subsectionpage=progressbar]{mis}

\setsansfont{Rosario}[Numbers=OldStyle]
\setmathfont{Asana Math}[Scale=MatchLowercase]
\setmonofont{Consolas}[Scale=MatchLowercase]

\title{Đại số quan hệ}
\institute{Khoa Hệ thống thông tin quản lý}
\author{Lê Thành Văn}
\date{\today}
% package setting
\hypersetup {
	colorlinks = true
}
%\usecolortheme{seahorse}
% graphic path
\graphicspath{{../../media/}}

%
\AtBeginSection{
  \frame{
    \sectionpage
  }
}
%newcommand
\newcommand{\mmm}[1]{\mathlarger{\mathlarger{\mathlarger#1}}}%
\newcommand{\ppi}[2]{\mmm{\pi}_{#1}\left(#2\right)}%
\newcommand{\psig}[2]{\mmm{\sigma}_{#1}\left(#2\right)}%
\newcommand{\prho}[2]{\mmm{\rho}_{#1}\left(#2\right)}%

\begin{document}
  \begin{frame}
    \titlepage
  \end{frame}
  \section{Giới thiệu}
  \subsection{Đại số quan hệ}
  \begin{frame}
    \textbf{Đại số quan hệ} là ngôn ngữ hình thức cho mô hình quan hệ được phát triển trước SQL. 
    Đại số quan hệ còn có thể được hiểu là tập các thao tác trên mô hình quan hệ, được sử dụng như là cơ sở cho việc cài đặt và tối ưu các câu lệnh truy vấn.
  \end{frame}
  \begin{frame}
    Một số khái niệm của đại số quan hệ được tích hợp vào các câu lệnh truy vấn của SQL, 
    do đó việc tìm hiểu về đại số quan hệ là bệ phóng để xây dựng và thực thi các câu lệnh SQL một cách có hiệu quả.
  \end{frame}
  \subsection{Các khái niệm chung}
  \begin{frame}
    \uncover<1->{Như tên gọi, các đối tượng chính trong đại số quan hệ gồm:}
    \begin{itemize}
      \item<2-> Các quan hệ.
      \item<3-> Những thao tác trên quan hệ.
    \end{itemize}  
  \end{frame}
  \begin{frame}
    Những thao tác thường được xét đến bao gồm
    \begin{itemize}
      \item Thao tác trên một quan hệ: phép chọn, phép chiếu.
      \item Thao tác trên nhiều quan hệ: phép hợp, phép giao, phép trừ, phép kết.
    \end{itemize}
    Ta gọi những thao tác này là các toán tử.
  \end{frame}
  \begin{frame}
    Sự kết hợp giữa các quan hệ cùng với các thao tác theo đúng cấu trúc được gọi là biểu thức quan hệ. \\
    \textit{Ví dụ}. $\ppi{A = 1}{R \times S}$ (chọn ra những dòng có cột $A$ bằng 1 từ 
    tích Đề-các của $R$ và $S$).
  \end{frame}
  \begin{frame}
    Kết quả của một biểu thức quan hệ là một quan hệ.
  \end{frame}
  \section{Các toán tử cơ bản}
  \subsection{Các ký hiệu cơ bản}
  \begin{frame}
    Để tiện cho việc theo dõi, chúng ta quy ước ký hiệu như sau:
    \begin{itemize}
      \item Tên quan hệ sẽ được ghi bằng chữ in hoa, ví dụ $R$, $S$, $CUSTOMER$, \dots
      \item Tên cột sẽ ghi bằng cách viết các từ dính liền nhau và ghi in hoa chữ cái đầu mỗi từ (viết kiểu Pascal), ví dụ
      Age, CustomerId, \dots 
    \end{itemize}
  \end{frame}
  \subsection{Các phép toán tập hợp}
  \begin{frame}
    \uncover<1->{Đại số quan hệ được xây dựng trên lý thuyết tập hợp, nên ta có một số toán tử sau:}
    \begin{itemize}
      \item<2-> Phép hợp $R \cup S$.
      \item<2-> Phép giao $R \cap S$.
      \item<2-> Phép trừ $R - S$, hoặc $R \setminus S$.
      \item<2-> Phép tích Đề-các $R \times S$.
    \end{itemize}
  \end{frame}
  \begin{frame}
    Trong đó, phép hợp, phép giao và phép trừ yêu cầu hai quan hệ $R$ và $S$ phải khả hợp.
  \end{frame}
  \begin{frame}
    \uncover<1->{\textit{Định nghĩa}. Hai quan hệ $R(A_0, A_1, \dots, A_n)$ và $S(B_0, B_1, \dots, B_m)$ được gọi là khả hợp khi:}
    \begin{itemize}
      \item<2-> Có cùng số cột, $n = m$.
      \item<3-> Miền xác định của $A_i$ phải giống miền xác định của $B_i$, $i = 0, 1, \dots, n$.
    \end{itemize}
  \end{frame}
  \begin{frame}
    \textit{Ví dụ}. Hai quan hệ sau đây là khả hợp:
    \begin{center}
      \begin{columns}[T]
        \begin{column}{0.5\textwidth}
          \begin{tabular}{|l|l|}
            \hline
            Tên & NgàySinh \\ \hline
            Tùng & 12/08/1955 \\ \hline
            Hằng & 19/07/1968 \\ \hline        
          \end{tabular}
        \end{column}
        \begin{column}{0.5\textwidth}
          \begin{tabular}{|l|l|}
            \hline
            Tên & SinhNhật \\ \hline
            Trinh & 05/07/1985 \\ \hline
            Khang & 29/02/1980 \\ \hline 
            Minh & 30/12/1988 \\ \hline
          \end{tabular}
        \end{column}
      \end{columns}
    \end{center}
  \end{frame}
  \begin{frame}
    Kết quả của $R \cup S$, $R \cap S$ và $R \setminus S$ là một quan hệ với tên cột là tên cột của $R$.
  \end{frame}
  \begin{frame}{Phép hợp}
    \textit{Định nghĩa}. Kết quả của phép hợp $R \cup S$ là tập hợp những dòng có trong $R$ \textbf{hoặc} có trong $S$.
    $$R \cup S = \{u\ |\ u \in R \vee u \in S\}$$
  \end{frame}
  \begin{frame}
    \begin{columns}[T]
      \begin{column}{0.3\textwidth}
        \centering $R$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{A}_0$ & $\textbf{A}_1$ \\[0.5ex] \hline\hline
          $\alpha$ & 1 \\ \hline
          $\alpha$ & 2 \\ \hline
          $\beta$ & 1 \\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.3\textwidth}
        \centering $S$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{B}_0$ & $\textbf{B}_1$ \\[0.5ex] \hline\hline
          $\alpha$ & 2 \\ \hline
          $\beta$ & 3 \\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.3\textwidth}
        \centering $R \cup S$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{A}_0$ & $\textbf{A}_1$ \\[0.5ex] \hline\hline
          $\alpha$ & 1 \\ \hline
          $\alpha$ & 2 \\ \hline
          $\beta$ & 1 \\ \hline
          $\beta$ & 3 \\ \hline
        \end{tabular}
      \end{column}
    \end{columns}
  \end{frame}
  \begin{frame}{Phép giao}
    \textit{Định nghĩa}. Kết quả của phép giao $R \cap  S$ là tập hợp những dòng có trong $R$ \textbf{và} có trong $S$.
    $$R \cap S = \{u\ |\ u \in R \wedge u \in S\}$$
  \end{frame}
  \begin{frame}
    \begin{columns}[T]
      \begin{column}{0.3\textwidth}
        \centering $R$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{A}_0$ & $\textbf{A}_1$ \\[0.5ex] \hline\hline
          $\alpha$ & 1 \\ \hline
          $\alpha$ & 2 \\ \hline
          $\beta$ & 1 \\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.3\textwidth}
        \centering $S$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{B}_0$ & $\textbf{B}_1$ \\[0.5ex] \hline\hline
          $\alpha$ & 2 \\ \hline
          $\beta$ & 3 \\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.3\textwidth}
        \centering $R \cap S$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{A}_0$ & $\textbf{A}_1$ \\[0.5ex] \hline\hline
          $\alpha$ & 2 \\ \hline
        \end{tabular}
      \end{column}
    \end{columns}
  \end{frame}
  \begin{frame}{Phép trừ}
    \textit{Định nghĩa}. Kết quả của phép trừ $R \setminus S$ là tập hợp những dòng \textbf{có} trong $R$ 
    \textbf{nhưng không có} trong $S$.
    $$R \setminus S = \{u\ |\ u \in R \wedge u \not\in S\}$$
  \end{frame}
  \begin{frame}
    \begin{columns}[T]
      \begin{column}{0.3\textwidth}
        \centering $R$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{A}_0$ & $\textbf{A}_1$ \\[0.5ex] \hline\hline
          $\alpha$ & 1 \\ \hline
          $\alpha$ & 2 \\ \hline
          $\beta$ & 1 \\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.3\textwidth}
        \centering $S$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{B}_0$ & $\textbf{B}_1$ \\[0.5ex] \hline\hline
          $\alpha$ & 2 \\ \hline
          $\beta$ & 3 \\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.3\textwidth}
        \centering $R \setminus S$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{A}_0$ & $\textbf{A}_1$ \\[0.5ex] \hline\hline
          $\alpha$ & 1 \\ \hline
          $\beta$ & 1 \\ \hline
        \end{tabular}
      \end{column}
    \end{columns}
  \end{frame}
  \begin{frame}{Phép tích Đề-các}
    \textit{Định nghĩa}. Cho quan hệ $R$ có $m$ cột và quan hệ $S$ có $n$ cột, 
    kết quả của phép tích Đề-các $R \times S$ là tập hợp những dòng có $m + n$ cột, 
    trong đó $m$ cột đầu là một dòng của $R$ và $n$ cột sau là một dòng của $S$.
    $$R \times S = \{\langle u, v\rangle \ |\ u \in R \wedge v \in S\}$$
  \end{frame}
  \begin{frame}
    \begin{columns}[T]
      \begin{column}{0.25\textwidth}
        \centering $R$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{A}_0$ & $\textbf{A}_1$ \\[0.5ex] \hline\hline
          $\alpha$ & 1 \\ \hline
          $\alpha$ & 2 \\ \hline
          $\beta$ & 1 \\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.25\textwidth}
        \centering $S$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          $\textbf{B}_0$ & $\textbf{B}_1$ \\[0.5ex] \hline\hline
          $\gamma$ & 2 \\ \hline
          $\delta$ & 3 \\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.4\textwidth}
        \centering $R \times S$
        \medskip \\
        \begin{tabular}{||c|c|c|c||}
          \hline
          $\textbf{A}_0$ & $\textbf{A}_1$ & $\textbf{B}_0$ & $\textbf{B}_1$\\[0.5ex] \hline\hline
          $\alpha$ & 1 & $\gamma$ & 2 \\ \hline
          $\alpha$ & 2 & $\gamma$ & 2 \\ \hline
          $\beta$ & 1 & $\gamma$ & 2 \\ \hline
          $\alpha$ & 1 & $\delta$ & 3 \\ \hline
          $\alpha$ & 2 & $\delta$ & 3\\ \hline
          $\beta$ & 1 & $\delta$ & 3\\ \hline
        \end{tabular}
      \end{column}
    \end{columns}
  \end{frame}
  \begin{frame}{Tính chất}
    \uncover<1->{
      Tính giao hoán
      \begin{itemize}
        \item $R \cup S = S \cup R$.
        \item $R \cap S = S \cap R$.
      \end{itemize}
    }
    \uncover<2->{
      Tính kết hợp
      \begin{itemize}
        \item $R \cup (S \cup T) = (R \cup S) \cup T$.
        \item $R \cap (S \cap T) = (R \cap S) \cap T$.
      \end{itemize}
    }
    \uncover<3->{
      Tính phân phối
      \begin{itemize}
        \item $R \cup (S \cap T) = (R \cup S) \cap (R \cup T)$.
        \item $R \cap (S \cup T) = (R \cap S) \cup (R \cap T)$.
      \end{itemize}
    }
  \end{frame}
  \subsection{Các toán tử quan hệ}
  \begin{frame}{Phép chiếu}
    \textit{Định nghĩa}. Cho quan hệ $R$ và một tập hợp $X$ gồm các cột có trong $R$, 
    kết quả của phép chiếu $\ppi{X}{R}$ là một quan hệ chỉ bao gồm những cột có trong $X$.
    Nói cách khác, ta loại bỏ khỏi $R$ những cột không có trong $X$. 
  \end{frame}
  \begin{frame}
    \begin{columns}[T]
      \begin{column}{0.4\textwidth}
        \centering $R$
        \bigskip \\
        \begin{tabular}{||c|c|c||}
          \hline
          \textbf{A} & \textbf{B} & \textbf{C}  \\[0.5ex] \hline\hline
          $\alpha$ & 1 & a\\ \hline
          $\alpha$ & 2 & a\\ \hline
          $\beta$ & 1 & b\\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.25\textwidth}
        \centering $\ppi{\text{A, B}}{R}$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          \textbf{A} & \textbf{B} \\[0.5ex] \hline\hline
          $\alpha$ & 1\\ \hline
          $\alpha$ & 2\\ \hline
          $\beta$ & 1\\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.25\textwidth}
        \centering $\ppi{\text{A, C}}{R}$
        \medskip \\
        \begin{tabular}{||c|c||}
          \hline
          \textbf{A} & \textbf{C} \\[0.5ex] \hline\hline
          $\alpha$ & a\\ \hline
          $\beta$ & b\\ \hline
        \end{tabular}
      \end{column}
    \end{columns}
  \end{frame}
  \begin{frame}{Phép chọn}
  \textit{Định nghĩa}. Cho quan hệ $R$ và điều kiện so sánh $\theta$, kết quả của 
  phép chọn $\psig{\theta}{R}$ là một quan hệ gồm \textbf{các dòng} mà điều kiện $\theta$ là đúng.
  \end{frame}
  \begin{frame}{Điều kiện so sánh}
    \uncover<1->{Điều kiện so sánh gồm hai dạng:}
    \begin{itemize}
      \item<2-> $\langle\text{tên cột 1}\rangle\langle\text{phép so sánh}\rangle\langle\text{tên cột 2}\rangle$.
      \item<3-> $\langle\text{tên cột}\rangle\langle\text{phép so sánh}\rangle\langle\text{giá trị vô hướng}\rangle$.
    \end{itemize}
  \end{frame}
  \begin{frame}
    \uncover<1->{Trong đó:}
    \begin{itemize}
      \item<2-> $\langle\text{phép so sánh}\rangle$ là các phép $<, >, \leq, \geq, =, \neq$.
      \item<3-> $\langle\text{giá trị vô hướng}\rangle$ là một giá trị thuộc về miền xác định của $\langle\text{tên cột}\rangle$.
    \end{itemize}
  \end{frame}
  \begin{frame}
    \uncover<1->{Ngoài ra, còn có thể kết hợp nhiều điều kiện so sánh với nhau 
    bằng $\wedge$ (phép hội), $\vee$ (phép tuyển) và $\neg$ (phép phủ định).}
    \begin{itemize}
      \item<2-> $\varphi \wedge \psi$: cả hai điều kiện được thỏa.
      \item<3-> $\varphi \vee \psi$: một trong hai điều kiện được thỏa.
      \item<4-> $\neg \varphi$: phủ định điều kiện $\varphi$ ($\neg (A < 5) \Leftrightarrow A \geq 5$).
    \end{itemize}
  \end{frame}
  \begin{frame}
    \begin{columns}[T]
      \begin{column}{0.3\textwidth}
        \centering $R$
        \bigskip \\
        \begin{tabular}{||c|c|c||}
          \hline
          \textbf{A} & \textbf{B} & \textbf{C}  \\[0.5ex] \hline\hline
          $\alpha$ & 1 & a\\ \hline
          $\alpha$ & 2 & a\\ \hline
          $\beta$ & 1 & b\\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.3\textwidth}
        \centering $\psig{\text{A} = \alpha}{R}$
        \medskip \\
        \begin{tabular}{||c|c|c||}
          \hline
          \textbf{A} & \textbf{B} & \textbf{C} \\[0.5ex] \hline\hline
          $\alpha$ & 1 & a\\ \hline
          $\alpha$ & 2 & a\\ \hline
        \end{tabular}
      \end{column}
      \begin{column}{0.3\textwidth}
        \centering $\psig{\text{A} = \alpha \wedge \text{B} < 2}{R}$
        \medskip \\
        \begin{tabular}{||c|c|c||}
          \hline
          \textbf{A} & \textbf{B} & \textbf{C} \\[0.5ex] \hline\hline
          $\alpha$ & 1 & a\\ \hline
          $\beta$ & 1 & b\\ \hline
        \end{tabular}
      \end{column}
    \end{columns}
  \end{frame}
  \begin{frame}{Tính chất phép chọn}
    \uncover<1->{Cho quan hệ $R$, hai điều kiện so sánh $\varphi$ và $\psi$, ta có các tính chất sau:}
    \begin{itemize}
      \item<2-> $\psig{\varphi}{\psig{\psi}{R}} = \psig{\varphi \wedge \psi}{R} = \psig{\varphi}{R} \cap \psig{\psi}{R}$
      \item<3-> $\psig{\varphi \vee \psi}{R} = \psig{\varphi}{R} \cup \psig{\psi}{R}$
      \item<4-> $\psig{\neg \varphi}{R} = R \setminus \psig{\varphi}{R}$
    \end{itemize}
  \end{frame}
  \begin{frame}
    \textit{Lưu ý}. Về cơ bản, giữa phép chọn và phép chiếu không có tính giao hoán, nghĩa là
    $$
    \ppi{X}{\psig{\theta}{R}} \neq \psig{\theta}{\ppi{X}{R}}
    $$
  \end{frame}
  \begin{frame}{Phép gán}
    \uncover<1->{Để tiện cho việc theo dõi, người ta thường tách một biểu thức quan hệ ra thành nhiều bước ngắn,
    vì thế, cần đặt một tên tạm cho kết quả ở mỗi bước.} \\
    \uncover<2->{Phép gán được ký hiệu bằng $\leftarrow$}.
  \end{frame}
  \begin{frame}
    \uncover<1->{Chẳng hạn, biểu thức $\ppi{X}{\psig{\theta}{R}}$ có thể được ghi thành:}
    \begin{enumerate}
      \item<2-> $T \leftarrow \psig{\theta}{R}$.
      \item<3-> $\ppi{X}{T}$.
    \end{enumerate}
  \end{frame}
  \begin{frame}{Phép đổi tên}
    \textit{Định nghĩa}. Cho quan hệ $R$ và cách đổi tên $N$, kết quả của phép đổi tên
    $\prho{N}{R}$ vẫn là những thông tin đó, nhưng với tên quan hệ và tên cột được thay đổi dựa theo cách đổi tên $N$.
  \end{frame}
  \begin{frame}{Cách đổi tên}
    \uncover<1->{Cách đổi tên $N$ có ba dạng sau:}
    \begin{itemize}
      \item<2-> $A/B$: đổi tên cột $B$ thành $A$.
      \item<3-> $(B_0, B_1, \dots, B_n)$: đổi tên cột đầu tiên thành $B_0$, cột thứ hai thành $B_1$, \dots
      \item<4-> $S(B_0, B_1, \dots, B_n)$: đổi tên quan hệ thành $S$, đổi tên cột đầu tiên thành $B_0$, cột thứ hai thành $B_1$, \dots
    \end{itemize}
  \end{frame}
  \begin{frame}
    \uncover<1->{Cho quan hệ $R(A, B, C)$, khi đó:}
    \uncover<2->{
      \begin{itemize}
        \item $\prho{D/A}{R} = R(D, B, C)$.
        \item $\prho{(D, E)}{R} = R(D, E, C)$.
        \item $\prho{S(D, E, F)}{R} = S(D, E, F)$.
      \end{itemize}
    }
  \end{frame}
  \begin{frame}
    Phép đổi tên thường được dùng trong trường hợp sử dụng đến phép kết 
    hoặc có tính toán giữa các cột với nhau.
  \end{frame}
\end{document}